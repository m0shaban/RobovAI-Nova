"""
Random User Generator Tool - Ù…ÙˆÙ„Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠÙŠÙ†
"""
import httpx
from typing import Dict, Any
from .base import BaseTool


class RandomUserTool(BaseTool):
    """
    Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    """
    @property
    def name(self) -> str:
        return "/randomuser"
    
    @property
    def description(self) -> str:
        return "ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ - Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±"
    
    @property
    def cost(self) -> int:
        return 10
    
    async def execute(self, user_input: str, user_id: str) -> Dict[str, Any]:
        """
        ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        """
        
        try:
            url = "https://randomuser.me/api/"
            
            async with httpx.AsyncClient(timeout=10.0) as client:
                response = await client.get(url)
                response.raise_for_status()
                data = response.json()
            
            if not data.get("results"):
                return {
                    "status": "error",
                    "output": "âŒ ÙØ´Ù„ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù…",
                    "tokens_deducted": 0
                }
            
            user = data["results"][0]
            
            # Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
            title = user["name"]["title"]
            first = user["name"]["first"]
            last = user["name"]["last"]
            gender = user["gender"].capitalize()
            
            # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
            email = user["email"]
            phone = user["phone"]
            cell = user["cell"]
            
            # Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            street_num = user["location"]["street"]["number"]
            street_name = user["location"]["street"]["name"]
            city = user["location"]["city"]
            state = user["location"]["state"]
            country = user["location"]["country"]
            postcode = user["location"]["postcode"]
            
            # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            dob = user["dob"]["date"][:10]
            age = user["dob"]["age"]
            username = user["login"]["username"]
            password = user["login"]["password"]
            picture = user["picture"]["large"]
            
            output = f"""ğŸ‘¤ **Random User Profile**

![Profile Picture]({picture})

**Personal Info:**
ğŸ‘¤ **Name:** {title} {first} {last}
âš§ï¸ **Gender:** {gender}
ğŸ‚ **Age:** {age} (Born: {dob})

**Contact:**
ğŸ“§ **Email:** {email}
ğŸ“ **Phone:** {phone}
ğŸ“± **Cell:** {cell}

**Address:**
ğŸ  {street_num} {street_name}
ğŸ™ï¸ {city}, {state}
ğŸŒ {country} - {postcode}

**Login Credentials:**
ğŸ‘¤ **Username:** `{username}`
ğŸ”’ **Password:** `{password}`

---
ğŸ² Generated by RandomUser.me API
âš ï¸ This is fake data for testing purposes only"""
            
            return {
                "status": "success",
                "output": output,
                "tokens_deducted": self.cost
            }
            
        except Exception as e:
            return {
                "status": "error",
                "output": f"âŒ Ø®Ø·Ø£: {str(e)}",
                "tokens_deducted": 0
            }
