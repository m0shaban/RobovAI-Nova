<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø­Ø³Ø§Ø¨ÙŠ - RobovAI Nova</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet" />
    <style>
        :root { --bg:#000; --surface:rgba(10,10,20,0.8); --primary:#00f0ff; --secondary:#8b5cf6; --accent:#ff00aa; --gold:#ffd700; --success:#22c55e; --error:#ef4444; --text:#fff; --muted:#6b7280; --border:rgba(255,255,255,0.08); }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Cairo',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; background-image:radial-gradient(circle at top right,#0a0a20,#000); }
        .container { max-width:1000px; margin:0 auto; padding:30px 20px; }

        /* Header */
        .page-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:40px; flex-wrap:wrap; gap:15px; }
        .page-title { font-size:2rem; font-weight:900; background:linear-gradient(90deg,var(--primary),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .back-btn { padding:10px 20px; background:var(--surface); border:1px solid var(--border); border-radius:12px; color:var(--text); text-decoration:none; transition:all .3s; font-family:inherit; }
        .back-btn:hover { border-color:var(--primary); color:var(--primary); }

        /* Cards Grid */
        .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:25px; margin-bottom:30px; }
        .card { background:var(--surface); backdrop-filter:blur(20px); border:1px solid var(--border); border-radius:20px; padding:25px; transition:all .3s; }
        .card:hover { border-color:rgba(0,240,255,0.3); }
        .card-icon { font-size:2.5rem; margin-bottom:15px; }
        .card h3 { font-size:1.3rem; margin-bottom:10px; }
        .card p { color:var(--muted); font-size:.9rem; line-height:1.8; }

        /* Balance Card */
        .balance-card { background:linear-gradient(135deg,rgba(0,240,255,0.1),rgba(139,92,246,0.1)); border-color:rgba(0,240,255,0.3); text-align:center; }
        .balance-big { font-size:3rem; font-weight:900; background:linear-gradient(90deg,var(--primary),var(--gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .balance-label { color:var(--muted); font-size:1rem; margin-top:5px; }

        /* Tier Badge */
        .tier-badge { display:inline-block; padding:6px 16px; border-radius:20px; font-size:.85rem; font-weight:700; margin-top:10px; }
        .tier-free { background:rgba(107,114,128,0.2); color:#9ca3af; border:1px solid #4b5563; }
        .tier-pro { background:rgba(255,215,0,0.15); color:var(--gold); border:1px solid rgba(255,215,0,0.4); }
        .tier-enterprise { background:rgba(139,92,246,0.15); color:var(--secondary); border:1px solid rgba(139,92,246,0.4); }

        /* Plans */
        .plans-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-top:25px; }
        .plan-card { background:var(--surface); border:2px solid var(--border); border-radius:20px; padding:30px; text-align:center; transition:all .3s; position:relative; overflow:hidden; }
        .plan-card:hover { border-color:var(--primary); transform:translateY(-5px); }
        .plan-card.popular { border-color:var(--gold); }
        .plan-card.popular::before { content:"Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ© â­"; position:absolute; top:15px; left:-30px; background:var(--gold); color:#000; padding:4px 40px; font-size:.75rem; font-weight:700; transform:rotate(45deg); }
        .plan-name { font-size:1.4rem; font-weight:700; margin-bottom:10px; }
        .plan-price { font-size:2.5rem; font-weight:900; margin:15px 0; }
        .plan-price span { font-size:1rem; color:var(--muted); }
        .plan-features { list-style:none; text-align:right; margin:20px 0; }
        .plan-features li { padding:8px 0; border-bottom:1px solid var(--border); color:var(--muted); font-size:.9rem; }
        .plan-features li::before { content:"âœ… "; }

        .btn { padding:14px 28px; border-radius:12px; border:none; font-family:inherit; font-weight:700; cursor:pointer; transition:all .3s; width:100%; font-size:1rem; }
        .btn-primary { background:linear-gradient(135deg,var(--primary),var(--secondary)); color:#000; }
        .btn-primary:hover { transform:scale(1.03); box-shadow:0 0 30px rgba(0,240,255,0.4); }
        .btn-outline { background:transparent; border:1px solid var(--border); color:var(--text); }
        .btn-gold { background:linear-gradient(135deg,var(--gold),#f59e0b); color:#000; }

        /* Usage Progress */
        .usage-bar { margin:15px 0; }
        .progress-bg { height:10px; background:rgba(255,255,255,0.1); border-radius:5px; overflow:hidden; }
        .progress-fill { height:100%; background:linear-gradient(90deg,var(--primary),var(--secondary)); border-radius:5px; transition:width .5s; }
        .usage-text { display:flex; justify-content:space-between; font-size:.85rem; color:var(--muted); margin-top:8px; }

        /* Token Packages */
        .token-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:15px; margin-top:20px; }
        .token-pkg { background:rgba(0,0,0,0.3); border:1px solid var(--border); border-radius:14px; padding:20px; text-align:center; cursor:pointer; transition:all .3s; }
        .token-pkg:hover { border-color:var(--primary); transform:scale(1.03); }
        .token-amount { font-size:1.8rem; font-weight:900; color:var(--primary); }
        .token-price { font-size:1.1rem; color:var(--gold); margin-top:8px; font-weight:700; }
        .token-save { font-size:.8rem; color:var(--success); margin-top:5px; }

        /* History Table */
        .history-table { width:100%; border-collapse:collapse; margin-top:15px; }
        .history-table th,.history-table td { padding:12px 15px; text-align:right; border-bottom:1px solid var(--border); }
        .history-table th { color:var(--primary); font-size:.85rem; }
        .history-table td { color:var(--muted); font-size:.9rem; }

        @media(max-width:768px) {
            .plans-grid { grid-template-columns:1fr; }
            .grid { grid-template-columns:1fr; }
            .page-title { font-size:1.5rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title">ğŸ’³ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
            <a href="/chat" class="back-btn">â†© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø§Øª</a>
        </div>

        <!-- Stats Cards -->
        <div class="grid" id="statsGrid">
            <div class="card balance-card">
                <div class="balance-big" id="balanceValue">...</div>
                <div class="balance-label">ØªÙˆÙƒÙ† Ù…ØªØ§Ø­</div>
                <div id="tierBadge" class="tier-badge tier-free">ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ“Š</div>
                <h3>Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                <div class="usage-bar">
                    <div class="progress-bg"><div class="progress-fill" id="usageProgress" style="width:0%"></div></div>
                    <div class="usage-text">
                        <span id="usageText">0 / 50</span>
                        <span id="usagePct">0%</span>
                    </div>
                </div>
                <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙŠÙˆÙ…</p>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ‘¤</div>
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="userName">...</span></p>
                <p><strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> <span id="userEmail">...</span></p>
                <p><strong>Ø§Ù„Ø¨Ø§Ù‚Ø©:</strong> <span id="userTier">Ù…Ø¬Ø§Ù†ÙŠ</span></p>
            </div>
        </div>

        <!-- Subscription Plans -->
        <div class="card" style="margin-bottom:30px">
            <h3 style="font-size:1.5rem; margin-bottom:5px;">ğŸš€ Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
            <p style="color:var(--muted); margin-bottom:10px;">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ</p>
            <div class="plans-grid" id="plansGrid">
                <!-- Injected by JS -->
            </div>
        </div>

        <!-- Buy Tokens -->
        <div class="card" style="margin-bottom:30px">
            <h3 style="font-size:1.5rem; margin-bottom:5px;">ğŸ’° Ø´Ø±Ø§Ø¡ ØªÙˆÙƒÙ†Ø² Ø¥Ø¶Ø§ÙÙŠØ©</h3>
            <p style="color:var(--muted); margin-bottom:10px;">Ø§Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ Ø¨Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† Ø£Ùˆ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</p>
            <div class="token-grid">
                <div class="token-pkg" onclick="buyTokens(100)">
                    <div class="token-amount">100</div>
                    <div>ØªÙˆÙƒÙ†</div>
                    <div class="token-price">50 Ø¬.Ù…</div>
                </div>
                <div class="token-pkg" onclick="buyTokens(500)">
                    <div class="token-amount">500</div>
                    <div>ØªÙˆÙƒÙ†</div>
                    <div class="token-price">200 Ø¬.Ù…</div>
                    <div class="token-save">ÙˆÙØ± 20%</div>
                </div>
                <div class="token-pkg" onclick="buyTokens(1000)">
                    <div class="token-amount">1000</div>
                    <div>ØªÙˆÙƒÙ†</div>
                    <div class="token-price">350 Ø¬.Ù…</div>
                    <div class="token-save">ÙˆÙØ± 30%</div>
                </div>
            </div>
        </div>

        <!-- Usage History -->
        <div class="card">
            <h3 style="font-size:1.5rem; margin-bottom:15px;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
            <table class="history-table">
                <thead><tr><th>Ø§Ù„Ø£Ø¯Ø§Ø©</th><th>Ø§Ù„ØªÙˆÙƒÙ†Ø²</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                <tbody id="historyBody">
                    <tr><td colspan="3" style="text-align:center; padding:30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login?redirect=/account';
        const API = window.location.origin;

        async function loadAccount() {
            try {
                const res = await fetch(`${API}/account/subscription`, {
                    headers: { Authorization: `Bearer ${token}` },
                    credentials: 'include',
                });
                if (res.status === 401) { localStorage.removeItem('token'); window.location.href = '/login?redirect=/account'; return; }
                const data = await res.json();
                if (data.status !== 'success') return;

                const sub = data.subscription;

                // Balance
                document.getElementById('balanceValue').textContent = sub.balance;

                // Usage
                const limit = sub.daily_limit === -1 ? 'âˆ' : sub.daily_limit;
                const pct = sub.daily_limit === -1 ? 0 : Math.round((sub.daily_used / sub.daily_limit) * 100);
                document.getElementById('usageProgress').style.width = Math.min(pct, 100) + '%';
                document.getElementById('usageText').textContent = `${sub.daily_used} / ${limit}`;
                document.getElementById('usagePct').textContent = pct + '%';

                // Tier badge
                const tierBadge = document.getElementById('tierBadge');
                const tierNames = { free: 'ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ', pro: 'â­ Pro', enterprise: 'ğŸ¢ Enterprise' };
                tierBadge.textContent = tierNames[sub.tier] || 'ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ';
                tierBadge.className = `tier-badge tier-${sub.tier}`;
                document.getElementById('userTier').textContent = tierNames[sub.tier] || 'Ù…Ø¬Ø§Ù†ÙŠ';

                // Plans
                const plansGrid = document.getElementById('plansGrid');
                plansGrid.innerHTML = '';
                const planIcons = { free: 'ğŸ†“', pro: 'â­', enterprise: 'ğŸ¢' };
                for (const [key, plan] of Object.entries(data.available_plans)) {
                    const isCurrent = key === sub.tier;
                    const isPopular = key === 'pro';
                    plansGrid.innerHTML += `
                        <div class="plan-card ${isPopular ? 'popular' : ''}" ${isCurrent ? 'style="border-color:var(--success)"' : ''}>
                            <div style="font-size:2.5rem">${planIcons[key] || 'ğŸ“¦'}</div>
                            <div class="plan-name">${plan.name}</div>
                            <div class="plan-price">${plan.price} <span>Ø¬.Ù… / Ø´Ù‡Ø±</span></div>
                            <ul class="plan-features">
                                ${plan.features.map(f => `<li>${f}</li>`).join('')}
                            </ul>
                            <button class="btn ${isCurrent ? 'btn-outline' : key === 'pro' ? 'btn-gold' : 'btn-primary'}" ${isCurrent ? 'disabled' : ''}>
                                ${isCurrent ? 'âœ… Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©' : 'Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†'}
                            </button>
                        </div>
                    `;
                }

                // History
                const historyBody = document.getElementById('historyBody');
                if (data.usage_history && data.usage_history.length > 0) {
                    historyBody.innerHTML = data.usage_history.map(h => `
                        <tr>
                            <td>${h.tool_name || 'Ø¹Ø§Ù…'}</td>
                            <td>${h.tokens_cost || 1}</td>
                            <td>${new Date(h.timestamp).toLocaleDateString('ar-EG')}</td>
                        </tr>
                    `).join('');
                } else {
                    historyBody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:30px;color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td></tr>';
                }

                // Profile
                const profRes = await fetch(`${API}/account/profile`, {
                    headers: { Authorization: `Bearer ${token}` },
                    credentials: 'include',
                });
                const profData = await profRes.json();
                if (profData.status === 'success') {
                    document.getElementById('userName').textContent = profData.profile.full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    document.getElementById('userEmail').textContent = profData.profile.email;
                }
            } catch (e) { console.error('Failed to load account:', e); }
        }

        function buyTokens(amount) {
            alert(`Ø´Ø±Ø§Ø¡ ${amount} ØªÙˆÙƒÙ† â€” Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ Ù‚Ø±ÙŠØ¨Ø§Ù‹! ğŸ’³`);
        }

        loadAccount();
    </script>
</body>
</html>
