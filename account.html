<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø­Ø³Ø§Ø¨ÙŠ - RobovAI Nova</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #000;
        --surface: rgba(10, 10, 20, 0.85);
        --surface-hover: rgba(15, 15, 30, 0.95);
        --primary: #00f0ff;
        --primary-glow: rgba(0, 240, 255, 0.25);
        --secondary: #8b5cf6;
        --secondary-glow: rgba(139, 92, 246, 0.25);
        --accent: #ff00aa;
        --gold: #ffd700;
        --gold-glow: rgba(255, 215, 0, 0.2);
        --success: #22c55e;
        --error: #ef4444;
        --warning: #f59e0b;
        --text: #fff;
        --muted: #94a3b8;
        --border: rgba(255, 255, 255, 0.08);
        --border-hover: rgba(0, 240, 255, 0.3);
        --radius: 20px;
        --radius-sm: 14px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Cairo', sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        background-image:
          radial-gradient(
            ellipse at 20% 0%,
            rgba(139, 92, 246, 0.12) 0%,
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 100%,
            rgba(0, 240, 255, 0.08) 0%,
            transparent 50%
          );
      }

      /* Top Nav */
      .top-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 24px;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .top-nav .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: var(--text);
      }
      .top-nav .brand-icon {
        width: 36px;
        height: 36px;
        border-radius: 0;
        background: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 17px;
      }

      .top-nav .brand-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.35))
          drop-shadow(0 0 18px rgba(139, 92, 246, 0.35));
      }
      .top-nav .brand-text {
        font-size: 1.05rem;
        font-weight: 700;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .nav-links {
        display: flex;
        gap: 6px;
        align-items: center;
        flex-wrap: wrap;
      }
      .nav-link {
        padding: 7px 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--muted);
        text-decoration: none;
        font-family: inherit;
        font-size: 0.82rem;
        font-weight: 600;
        transition: var(--transition);
        cursor: pointer;
        white-space: nowrap;
      }
      .nav-link:hover {
        border-color: var(--primary);
        color: var(--primary);
      }
      .nav-link.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #000;
        border-color: transparent;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 28px 20px 60px;
      }

      /* Page Header */
      .page-header {
        margin-bottom: 28px;
      }
      .page-title {
        font-size: 1.7rem;
        font-weight: 900;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 4px;
      }
      .page-subtitle {
        color: var(--muted);
        font-size: 0.92rem;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
        margin-bottom: 28px;
      }
      .stat-card {
        background: var(--surface);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 22px;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }
      .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        opacity: 0;
        transition: opacity 0.3s;
      }
      .stat-card:hover {
        border-color: var(--border-hover);
      }
      .stat-card:hover::before {
        opacity: 1;
      }
      .stat-icon {
        font-size: 1.8rem;
        margin-bottom: 10px;
        display: block;
      }
      .stat-label {
        color: var(--muted);
        font-size: 0.82rem;
        margin-bottom: 4px;
      }
      .stat-value {
        font-size: 1.9rem;
        font-weight: 900;
        background: linear-gradient(90deg, var(--primary), var(--gold));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .tier-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.82rem;
        font-weight: 700;
        margin-top: 8px;
      }
      .tier-free {
        background: rgba(107, 114, 128, 0.2);
        color: #9ca3af;
        border: 1px solid #4b5563;
      }
      .tier-pro {
        background: var(--gold-glow);
        color: var(--gold);
        border: 1px solid rgba(255, 215, 0, 0.4);
      }
      .tier-enterprise {
        background: var(--secondary-glow);
        color: var(--secondary);
        border: 1px solid rgba(139, 92, 246, 0.4);
      }

      .usage-bar {
        margin: 10px 0 4px;
      }
      .progress-bg {
        height: 8px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 4px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 4px;
        transition: width 0.6s ease;
      }
      .usage-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.76rem;
        color: var(--muted);
        margin-top: 5px;
      }

      /* Section */
      .section {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 26px;
        margin-bottom: 22px;
        transition: var(--transition);
      }
      .section:hover {
        border-color: rgba(255, 255, 255, 0.12);
      }
      .section-title {
        font-size: 1.25rem;
        font-weight: 800;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .section-desc {
        color: var(--muted);
        font-size: 0.88rem;
        margin-bottom: 18px;
      }

      /* Plans Grid */
      .plans-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
      }
      .plan-card {
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid var(--border);
        border-radius: var(--radius);
        padding: 24px 20px;
        text-align: center;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      .plan-card:hover {
        border-color: var(--border-hover);
        transform: translateY(-3px);
        box-shadow: 0 14px 36px rgba(0, 0, 0, 0.4);
      }
      .plan-card.popular {
        border-color: var(--gold);
        box-shadow: 0 0 24px var(--gold-glow);
      }
      .plan-card.current {
        border-color: var(--success);
      }
      .plan-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        padding: 3px 10px;
        border-radius: 8px;
        font-size: 0.68rem;
        font-weight: 700;
      }
      .badge-popular {
        background: var(--gold);
        color: #000;
      }
      .badge-current {
        background: var(--success);
        color: #000;
      }
      .plan-icon {
        font-size: 2.2rem;
        margin-bottom: 10px;
      }
      .plan-name {
        font-size: 1.15rem;
        font-weight: 700;
        margin-bottom: 6px;
      }
      .plan-price {
        font-size: 2rem;
        font-weight: 900;
        margin: 6px 0;
      }
      .plan-price .currency {
        font-size: 0.82rem;
        color: var(--muted);
        font-weight: 500;
      }
      .plan-features {
        list-style: none;
        text-align: right;
        margin: 14px 0;
        flex: 1;
      }
      .plan-features li {
        padding: 6px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        color: var(--muted);
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .plan-features li .ck {
        color: var(--success);
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 11px 22px;
        border-radius: var(--radius-sm);
        border: none;
        font-family: inherit;
        font-weight: 700;
        font-size: 0.92rem;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
        text-decoration: none;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #000;
      }
      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px var(--primary-glow);
      }
      .btn-gold {
        background: linear-gradient(135deg, var(--gold), #f59e0b);
        color: #000;
      }
      .btn-gold:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px var(--gold-glow);
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }
      .btn-outline:hover:not(:disabled) {
        border-color: var(--primary);
        color: var(--primary);
      }
      .btn-success {
        background: var(--success);
        color: #000;
      }
      .btn-sm {
        padding: 8px 14px;
        font-size: 0.84rem;
        border-radius: 10px;
      }

      /* Token Cards */
      .token-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
      .token-card {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px 14px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
      }
      .token-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
      }
      .token-card.selected {
        border-color: var(--primary);
        background: rgba(0, 240, 255, 0.06);
      }
      .token-amount {
        font-size: 1.7rem;
        font-weight: 900;
        color: var(--primary);
      }
      .token-label {
        color: var(--muted);
        font-size: 0.82rem;
        margin-bottom: 4px;
      }
      .token-price {
        font-size: 1rem;
        color: var(--gold);
        font-weight: 700;
        margin-top: 6px;
      }
      .token-save {
        display: inline-block;
        padding: 2px 8px;
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        border-radius: 6px;
        font-size: 0.72rem;
        font-weight: 600;
        margin-top: 5px;
      }

      /* Payment Methods */
      .payment-methods {
        display: flex;
        gap: 10px;
        margin: 14px 0;
      }
      .pm-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        background: rgba(0, 0, 0, 0.3);
        color: var(--text);
        font-family: inherit;
        font-size: 0.88rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .pm-btn:hover {
        border-color: var(--primary);
      }
      .pm-btn.active {
        border-color: var(--primary);
        background: rgba(0, 240, 255, 0.08);
        color: var(--primary);
      }

      /* History */
      .history-table {
        width: 100%;
        border-collapse: collapse;
      }
      .history-table th,
      .history-table td {
        padding: 11px 12px;
        text-align: right;
        border-bottom: 1px solid var(--border);
      }
      .history-table th {
        color: var(--primary);
        font-size: 0.8rem;
        font-weight: 600;
      }
      .history-table td {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .history-table tr:hover td {
        color: var(--text);
      }
      .empty-state {
        text-align: center;
        padding: 36px;
        color: var(--muted);
      }

      /* Profile */
      .profile-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .profile-item {
        padding: 12px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
      }
      .profile-item .label {
        font-size: 0.76rem;
        color: var(--muted);
        margin-bottom: 3px;
      }
      .profile-item .value {
        font-size: 0.92rem;
        font-weight: 600;
      }

      /* Toast */
      .toast {
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%) translateY(-20px);
        padding: 13px 26px;
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: 0.92rem;
        z-index: 9999;
        opacity: 0;
        transition: all 0.4s ease;
        pointer-events: none;
        backdrop-filter: blur(20px);
      }
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      .toast-success {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid var(--success);
        color: var(--success);
      }
      .toast-error {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid var(--error);
        color: var(--error);
      }
      .toast-info {
        background: rgba(0, 240, 255, 0.15);
        border: 1px solid var(--primary);
        color: var(--primary);
      }

      .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid transparent;
        border-top-color: currentColor;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Modal overlay */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.2s;
      }
      .modal-box {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 28px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }
      .modal-box h3 {
        margin-bottom: 6px;
        font-size: 1.15rem;
      }
      .modal-box p {
        color: var(--muted);
        font-size: 0.85rem;
        margin-bottom: 18px;
      }
      .modal-btns {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .plans-grid {
          grid-template-columns: 1fr;
        }
        .token-grid {
          grid-template-columns: 1fr;
        }
        .profile-grid {
          grid-template-columns: 1fr;
        }
        .payment-methods {
          flex-direction: column;
        }
        .nav-links {
          gap: 4px;
        }
        .nav-link {
          padding: 5px 9px;
          font-size: 0.78rem;
        }
        .page-title {
          font-size: 1.3rem;
        }
        .container {
          padding: 18px 12px 40px;
        }
        .top-nav {
          padding: 10px 14px;
          flex-wrap: wrap;
          gap: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="toast" id="toast"></div>

    <!-- Top Nav -->
    <nav class="top-nav">
      <a href="/" class="brand">
        <div class="brand-icon">
          <img src="public/assets/logo.png" alt="RobovAI Nova" />
        </div>
        <span class="brand-text">RobovAI Nova</span>
      </a>
      <div class="nav-links">
        <a href="/chat" class="nav-link">ğŸ’¬ Ø§Ù„Ø´Ø§Øª</a>
        <a href="/settings" class="nav-link">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        <a href="/account" class="nav-link active">ğŸ’³ Ø­Ø³Ø§Ø¨ÙŠ</a>
        <button class="nav-link" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
      </div>
    </nav>

    <div class="container">
      <div class="page-header">
        <h1 class="page-title">ğŸ’³ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
        <p class="page-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù‚ØªÙƒØŒ Ø§Ù„ØªÙˆÙƒÙ†Ø²ØŒ ÙˆØ³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</p>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">ğŸ’°</span>
          <div class="stat-label">Ø±ØµÙŠØ¯ Ø§Ù„ØªÙˆÙƒÙ†Ø²</div>
          <div class="stat-value" id="balanceValue">...</div>
          <div id="tierBadge" class="tier-badge tier-free">ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">ğŸ“Š</span>
          <div class="stat-label">Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
          <div class="usage-bar">
            <div class="progress-bg">
              <div
                class="progress-fill"
                id="usageProgress"
                style="width: 0%"
              ></div>
            </div>
            <div class="usage-meta">
              <span id="usageText">0 / 50</span>
              <span id="usagePct">0%</span>
            </div>
          </div>
          <div style="color: var(--muted); font-size: 0.78rem; margin-top: 6px">
            Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…
          </div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">ğŸ‘¤</span>
          <div class="stat-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div style="margin-top: 6px">
            <div style="font-size: 0.85rem; margin-bottom: 3px">
              <strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="userName">...</span>
            </div>
            <div style="font-size: 0.85rem; margin-bottom: 3px">
              <strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> <span id="userEmail">...</span>
            </div>
            <div style="font-size: 0.85rem">
              <strong>Ø§Ù„Ø¨Ø§Ù‚Ø©:</strong> <span id="userTier">Ù…Ø¬Ø§Ù†ÙŠ</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Plans -->
      <div class="section">
        <div class="section-title">ğŸš€ Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
        <div class="section-desc">
          Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© â€” Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø©
          Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¹Ø¨Ø± Paymob
        </div>
        <div class="plans-grid" id="plansGrid"></div>
      </div>

      <!-- Buy Tokens -->
      <div class="section">
        <div class="section-title">ğŸ’° Ø´Ø±Ø§Ø¡ ØªÙˆÙƒÙ†Ø² Ø¥Ø¶Ø§ÙÙŠØ©</div>
        <div class="section-desc">Ø§Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª</div>
        <div class="token-grid" id="tokenGrid">
          <div
            class="token-card"
            data-pkg="tokens_500"
            onclick="selectToken(this, 'tokens_500')"
          >
            <div class="token-amount">500</div>
            <div class="token-label">ØªÙˆÙƒÙ†</div>
            <div class="token-price">149 Ø¬.Ù…</div>
          </div>
          <div
            class="token-card selected"
            data-pkg="tokens_2000"
            onclick="selectToken(this, 'tokens_2000')"
          >
            <div class="token-amount">2,000</div>
            <div class="token-label">ØªÙˆÙƒÙ†</div>
            <div class="token-price">449 Ø¬.Ù…</div>
            <div class="token-save">ÙˆÙÙ‘Ø± 25%</div>
          </div>
          <div
            class="token-card"
            data-pkg="tokens_5000"
            onclick="selectToken(this, 'tokens_5000')"
          >
            <div class="token-amount">5,000</div>
            <div class="token-label">ØªÙˆÙƒÙ†</div>
            <div class="token-price">899 Ø¬.Ù…</div>
            <div class="token-save">ÙˆÙÙ‘Ø± 40%</div>
          </div>
        </div>
        <div class="payment-methods">
          <button
            class="pm-btn active"
            onclick="selectPaymentMethod(this, 'card')"
          >
            ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†
          </button>
          <button class="pm-btn" onclick="selectPaymentMethod(this, 'wallet')">
            ğŸ“± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©
          </button>
        </div>
        <div id="walletPhoneInput" style="display: none; margin: 12px 0">
          <input
            type="tel"
            id="walletPhone"
            placeholder="01xxxxxxxxx Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©"
            style="
              width: 100%;
              padding: 12px 16px;
              border-radius: 12px;
              border: 1px solid rgba(255, 255, 255, 0.1);
              background: rgba(255, 255, 255, 0.05);
              color: #fff;
              font-size: 15px;
              font-family: inherit;
              direction: ltr;
              text-align: center;
            "
          />
        </div>
        <button class="btn btn-primary" id="buyTokensBtn" onclick="buyTokens()">
          ğŸ’³ Ø´Ø±Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†Ø² Ø§Ù„Ø¢Ù†
        </button>
      </div>

      <!-- Profile -->
      <div class="section">
        <div class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
        <div class="section-desc">Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ</div>
        <div class="profile-grid" id="profileGrid"></div>
      </div>

      <!-- History -->
      <div class="section">
        <div class="section-title">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</div>
        <div class="section-desc">Ø¢Ø®Ø± 10 Ø¹Ù…Ù„ÙŠØ§Øª</div>
        <table class="history-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø£Ø¯Ø§Ø©</th>
              <th>Ø§Ù„ØªÙˆÙƒÙ†Ø²</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody id="historyBody">
            <tr>
              <td colspan="3" class="empty-state">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      const API = window.location.origin;
      const token = localStorage.getItem('token');
      let selectedPackage = 'tokens_2000';
      let selectedMethod = 'card';
      let currentTier = 'free';

      if (!token) window.location.href = '/login?redirect=/account';

      function showToast(msg, type = 'info') {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = `toast toast-${type} show`;
        setTimeout(() => t.classList.remove('show'), 4000);
      }

      function authHeaders() {
        return {
          Authorization: `Bearer ${token}`,
          'Content-Type': 'application/json',
        };
      }

      async function loadAccount() {
        try {
          const [subRes, profRes] = await Promise.all([
            fetch(`${API}/account/subscription`, {
              headers: authHeaders(),
              credentials: 'include',
            }),
            fetch(`${API}/account/profile`, {
              headers: authHeaders(),
              credentials: 'include',
            }),
          ]);

          if (subRes.status === 401 || profRes.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login?redirect=/account';
            return;
          }

          const subData = await subRes.json();
          const profData = await profRes.json();

          if (subData.status === 'success') {
            const sub = subData.subscription;
            currentTier = sub.tier || 'free';

            document.getElementById('balanceValue').textContent =
              sub.balance?.toLocaleString() || '0';

            const limit = sub.daily_limit === -1 ? Infinity : sub.daily_limit;
            const pct =
              limit === Infinity
                ? 0
                : Math.round((sub.daily_used / limit) * 100);
            document.getElementById('usageProgress').style.width =
              Math.min(pct, 100) + '%';
            document.getElementById('usageText').textContent =
              `${sub.daily_used} / ${limit === Infinity ? 'âˆ' : limit}`;
            document.getElementById('usagePct').textContent = pct + '%';

            const tierNames = {
              free: 'ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ',
              pro: 'â­ Pro',
              enterprise: 'ğŸ¢ Enterprise',
            };
            const badge = document.getElementById('tierBadge');
            badge.textContent = tierNames[currentTier] || 'ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠ';
            badge.className = `tier-badge tier-${currentTier}`;
            document.getElementById('userTier').textContent =
              tierNames[currentTier] || 'Ù…Ø¬Ø§Ù†ÙŠ';

            renderPlans(subData.available_plans, currentTier);
            renderHistory(subData.usage_history || []);
          }

          if (profData.status === 'success') {
            const p = profData.profile;
            document.getElementById('userName').textContent =
              p.full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('userEmail').textContent = p.email || '';
            renderProfile(p);
          }
        } catch (e) {
          console.error('Load account error:', e);
          showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
        }
      }

      function renderPlans(plans, current) {
        const grid = document.getElementById('plansGrid');
        const icons = { free: 'ğŸ†“', pro: 'â­', enterprise: 'ğŸ¢' };
        const prices = { free: 0, pro: 299, enterprise: 1499 };
        grid.innerHTML = '';

        for (const [key, plan] of Object.entries(plans)) {
          const isCurrent = key === current;
          const isPopular = key === 'pro';
          const price = prices[key] || plan.price || 0;

          grid.innerHTML += `
            <div class="plan-card ${isPopular ? 'popular' : ''} ${isCurrent ? 'current' : ''}">
              ${isPopular && !isCurrent ? '<span class="plan-badge badge-popular">â­ Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</span>' : ''}
              ${isCurrent ? '<span class="plan-badge badge-current">âœ… Ø¨Ø§Ù‚ØªÙƒ</span>' : ''}
              <div class="plan-icon">${icons[key] || 'ğŸ“¦'}</div>
              <div class="plan-name">${plan.name}</div>
              <div class="plan-price">${price === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : price} ${price > 0 ? '<span class="currency">Ø¬.Ù… / Ø´Ù‡Ø±</span>' : ''}</div>
              <ul class="plan-features">
                ${plan.features.map((f) => `<li><span class="ck">âœ“</span> ${f}</li>`).join('')}
              </ul>
              ${
                isCurrent
                  ? '<button class="btn btn-success btn-sm" disabled>âœ… Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>'
                  : key === 'free'
                    ? '<button class="btn btn-outline btn-sm" disabled>Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</button>'
                    : `<button class="btn ${isPopular ? 'btn-gold' : 'btn-primary'} btn-sm" onclick="subscribePlan('${key}')">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</button>`
              }
            </div>`;
        }
      }

      function renderHistory(history) {
        const body = document.getElementById('historyBody');
        if (!history.length) {
          body.innerHTML =
            '<tr><td colspan="3" class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>';
          return;
        }
        body.innerHTML = history
          .map(
            (h) =>
              `<tr><td>${h.tool_name || 'Ø¹Ø§Ù…'}</td><td>${h.tokens_cost ?? 1}</td><td>${new Date(h.timestamp).toLocaleDateString('ar-EG', { day: 'numeric', month: 'short', year: 'numeric' })}</td></tr>`,
          )
          .join('');
      }

      function renderProfile(p) {
        document.getElementById('profileGrid').innerHTML = `
          <div class="profile-item"><div class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</div><div class="value">${p.full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div></div>
          <div class="profile-item"><div class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div><div class="value">${p.email}</div></div>
          <div class="profile-item"><div class="label">Ø§Ù„Ø¨Ø§Ù‚Ø©</div><div class="value">${{ free: 'Ù…Ø¬Ø§Ù†ÙŠ', pro: 'Pro â­', enterprise: 'Enterprise ğŸ¢' }[p.tier] || 'Ù…Ø¬Ø§Ù†ÙŠ'}</div></div>
          <div class="profile-item"><div class="label">Ø§Ù„Ø±ØµÙŠØ¯</div><div class="value">${p.balance?.toLocaleString() || 0} ØªÙˆÙƒÙ†</div></div>
          <div class="profile-item"><div class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div><div class="value">${p.created_at ? new Date(p.created_at).toLocaleDateString('ar-EG') : 'â€”'}</div></div>
          <div class="profile-item"><div class="label">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</div><div class="value">${p.role === 'admin' ? 'ğŸ‘‘ Ù…Ø³Ø¤ÙˆÙ„' : 'ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù…'}</div></div>`;
      }

      function selectToken(el, pkg) {
        document
          .querySelectorAll('.token-card')
          .forEach((c) => c.classList.remove('selected'));
        el.classList.add('selected');
        selectedPackage = pkg;
      }

      function selectPaymentMethod(el, method) {
        document
          .querySelectorAll('.pm-btn')
          .forEach((b) => b.classList.remove('active'));
        el.classList.add('active');
        selectedMethod = method;
        const phoneInput = document.getElementById('walletPhoneInput');
        if (phoneInput)
          phoneInput.style.display = method === 'wallet' ? 'block' : 'none';
      }

      async function buyTokens() {
        const btn = document.getElementById('buyTokensBtn');
        const orig = btn.innerHTML;
        btn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
        btn.disabled = true;

        const phoneEl = document.getElementById('walletPhone');
        const phone_number = phoneEl ? phoneEl.value.trim() : '';
        if (
          selectedMethod === 'wallet' &&
          (!phone_number || !/^01[0-9]{9}$/.test(phone_number))
        ) {
          showToast('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© ØµØ­ÙŠØ­ (01xxxxxxxxx)', 'error');
          btn.innerHTML = orig;
          btn.disabled = false;
          return;
        }

        try {
          const res = await fetch(`${API}/account/buy-tokens`, {
            method: 'POST',
            headers: authHeaders(),
            credentials: 'include',
            body: JSON.stringify({
              package_id: selectedPackage,
              method: selectedMethod,
              phone_number,
            }),
          });
          const data = await res.json();
          if (data.payment_type === 'wallet_pending') {
            showToast(
              data.message ||
                'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹ Ù„Ù‡Ø§ØªÙÙƒ. Ø§ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹.',
              'success',
            );
            btn.innerHTML = orig;
            btn.disabled = false;
          } else if (data.checkout_url) {
            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹...', 'info');
            setTimeout(() => {
              window.location.href = data.checkout_url;
            }, 500);
          } else {
            showToast(data.detail || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹', 'error');
            btn.innerHTML = orig;
            btn.disabled = false;
          }
        } catch (e) {
          console.error(e);
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
          btn.innerHTML = orig;
          btn.disabled = false;
        }
      }

      async function subscribePlan(plan) {
        const result = await pickPaymentMethod();
        if (!result) return;
        const { method, phone_number } = result;

        showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹...', 'info');

        try {
          const res = await fetch(`${API}/account/subscribe`, {
            method: 'POST',
            headers: authHeaders(),
            credentials: 'include',
            body: JSON.stringify({ plan, method, phone_number }),
          });
          const data = await res.json();
          if (data.payment_type === 'wallet_pending') {
            showToast(
              data.message ||
                'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹ Ù„Ù‡Ø§ØªÙÙƒ. Ø§ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹.',
              'success',
            );
          } else if (data.checkout_url) {
            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹...', 'info');
            setTimeout(() => {
              window.location.href = data.checkout_url;
            }, 500);
          } else {
            showToast(data.detail || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹', 'error');
          }
        } catch (e) {
          console.error(e);
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
        }
      }

      function pickPaymentMethod() {
        return new Promise((resolve) => {
          const overlay = document.createElement('div');
          overlay.className = 'modal-overlay';
          overlay.innerHTML = `
            <div class="modal-box">
              <h3>ğŸ’³ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
              <p>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹</p>
              <div class="modal-btns">
                <button class="btn btn-primary" data-val="card">ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† (Visa / Mastercard)</button>
                <button class="btn btn-gold" id="modalWalletBtn" data-val="wallet">ğŸ“± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© (ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´)</button>
                <div id="modalWalletPhone" style="display:none; margin: 8px 0; width:100%;">
                  <input type="tel" id="modalPhoneInput" placeholder="01xxxxxxxxx Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©"
                    style="width:100%; padding:12px 16px; border-radius:12px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.05); color:#fff; font-size:15px; font-family:inherit; direction:ltr; text-align:center;" />
                  <button class="btn btn-gold" id="modalWalletConfirm" style="margin-top:8px; width:100%;">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
                </div>
                <button class="btn btn-outline" data-val="">âŒ Ø¥Ù„ØºØ§Ø¡</button>
              </div>
            </div>`;
          overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
              overlay.remove();
              resolve(null);
            }
          });
          // Card button
          overlay
            .querySelector('[data-val="card"]')
            .addEventListener('click', () => {
              overlay.remove();
              resolve({ method: 'card', phone_number: '' });
            });
          // Wallet button â€” show phone input
          overlay
            .querySelector('#modalWalletBtn')
            .addEventListener('click', () => {
              overlay.querySelector('#modalWalletPhone').style.display =
                'block';
              overlay.querySelector('#modalPhoneInput').focus();
            });
          // Wallet confirm
          overlay
            .querySelector('#modalWalletConfirm')
            ?.addEventListener('click', () => {
              const phone = overlay
                .querySelector('#modalPhoneInput')
                .value.trim();
              if (!phone || !/^01[0-9]{9}$/.test(phone)) {
                alert('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© ØµØ­ÙŠØ­ (01xxxxxxxxx)');
                return;
              }
              overlay.remove();
              resolve({ method: 'wallet', phone_number: phone });
            });
          // Cancel
          overlay
            .querySelector('[data-val=""]')
            .addEventListener('click', () => {
              overlay.remove();
              resolve(null);
            });
          document.body.appendChild(overlay);
        });
      }

      async function logout() {
        try {
          await fetch(`${API}/auth/logout`, {
            method: 'POST',
            credentials: 'include',
          });
        } catch (e) {}
        localStorage.removeItem('token');
        window.location.href = '/login';
      }

      // Check payment status from redirect
      (function () {
        const p = new URLSearchParams(window.location.search);
        if (p.get('payment') === 'success') {
          showToast('ğŸ‰ ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø³Ø§Ø¨Ùƒ', 'success');
          history.replaceState(null, '', '/account');
        } else if (p.get('payment') === 'failed') {
          showToast('âŒ ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
          history.replaceState(null, '', '/account');
        }
      })();

      loadAccount();
    </script>
  </body>
</html>
